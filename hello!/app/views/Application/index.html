#{extends 'main.html' /} 
#{set title:'Geoloc\'UPO' /}

<!-- Modal -->
<div id="details" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal"
			aria-hidden="true">×</button>
		<h3 id="myModalLabel">Titre POI</h3>
	</div>
	<div class="modal-body">
		<div align="center">
			<div id="myCarousel" class="carousel slide" style="width:300px;">
		  		<ol class="carousel-indicators">
		    		<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
		    		<li data-target="#myCarousel" data-slide-to="1"></li>
		    		<li data-target="#myCarousel" data-slide-to="2"></li>
		  		</ol>
		  		
		  		<div class="carousel-inner">
		   			<div class="item active">
						<img src="http://www.nanterrelaverte.fr/wp-content/uploads/2012/11/antennes_relais_Bouygues_SFR_batimentG_Nanterre-300x224.jpg" alt="">
						<div class="carousel-caption">
							<p>Texte de l'image</p>
						</div>
					</div>
		    		<div class="item">
						<img src="http://www.nanterrelaverte.fr/wp-content/uploads/2012/11/antennes_relais_Bouygues_SFR_batimentG_Nanterre-300x224.jpg" alt="">
						<div class="carousel-caption">
							<p>Texte de l'image</p>
						</div>
					</div>
		    		<div class="item">
		    			<img src="http://www.nanterrelaverte.fr/wp-content/uploads/2012/11/antennes_relais_Bouygues_SFR_batimentG_Nanterre-300x224.jpg" alt="">
						<div class="carousel-caption">
							<p>Texte de l'image</p>
						</div>
					</div>
		  		</div>
		  		
		  		<a class="carousel-control left" href="#myCarousel" data-slide="prev">&lsaquo;</a>
		  		<a class="carousel-control right" href="#myCarousel" data-slide="next">&rsaquo;</a>
			</div>
		</div>
		<br />
		<div class="accordion" id="accordion2">
			<div class="accordion-group">
				<div class="accordion-heading">
					<a class="accordion-toggle" data-toggle="collapse"
						data-parent="#accordion2" href="#Historique"> Historique </a>
				</div>
				<div id="Historique" class="accordion-body collapse">
					<div class="accordion-inner">
						Date de Construction : 1968 <br /> Fondateur : Mendras <br />
					</div>
				</div>
			</div>
			<div class="accordion-group">
				<div class="accordion-heading">
					<a class="accordion-toggle" data-toggle="collapse"
						data-parent="#accordion2" href="#Culturel"> Culturel </a>
				</div>
				<div id="Culturel" class="accordion-body collapse">
					<div class="accordion-inner">
						Association : Izer <br />
					</div>
				</div>
			</div>
			<div class="accordion-group">
				<div class="accordion-heading">
					<a class="accordion-toggle" data-toggle="collapse"
						data-parent="#accordion2" href="#Evenementiel"> Evénementiel </a>
				</div>
				<div id="Evenementiel" class="accordion-body collapse">
					<div class="accordion-inner">
						Expositions : Prototype robot <br /> Débats : Examens reportés <br />
						Projections de films : Iron Man 3 <br /> Concours : Iphone 5 a
						gagner <br />
					</div>
				</div>
			</div>
			<div class="accordion-group">
				<div class="accordion-heading">
					<a class="accordion-toggle" data-toggle="collapse"
						data-parent="#accordion2" href="#Enseignement"> Enseignement </a>
				</div>
				<div id="Enseignement" class="accordion-body collapse">
					<div class="accordion-inner">
						Les UFR : SEGMI <br /> Les formations : MIAGE, Economie-Gestion <br />
					</div>
				</div>
			</div>
			<div class="accordion-group">
				<div class="accordion-heading">
					<a class="accordion-toggle" data-toggle="collapse"
						data-parent="#accordion2" href="#OrganisationAdministrative">
						Organisation Administrative </a>
				</div>
				<div id="OrganisationAdministrative" class="accordion-body collapse">
					<div class="accordion-inner">
						Directeur : Izer <br /> Directeur adjoint : Izer <br />
						Responsable administratif : Izer <br /> Secrétariat : Izer <br />
					</div>
				</div>
			</div>
			<div class="accordion-group">
				<div class="accordion-heading">
					<a class="accordion-toggle" data-toggle="collapse"
						data-parent="#accordion2" href="#Services"> Services </a>
				</div>
				<div id="Services" class="accordion-body collapse">
					<div class="accordion-inner">
						Covoiturage : Izer <br />
					</div>
				</div>
			</div>
		</div>
		<div class="fb-comments" data-href="http://geoloc-upo.servebeer.com/"
			data-width="470" data-num-posts="10"></div>
	</div>
	<div class="modal-footer">
		<button class="btn btn-primary" data-dismiss="modal"
			aria-hidden="true">Retour</button>
	</div>
</div>

<div id="map"></div>

<script type="text/javascript">
	var map = L.map('map', {
		center : [ 48.904, 2.2135 ],
		zoom : 17
	});
	L.tileLayer(
		'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
		{
			attribution : 'Map data &copy; OpenStreetMap contributors - <a href="http://www.hostedredmine.com/projects/geoloc-upo">Our Redmine</a>, proudly powered by <a href="http://www.hostedredmine.com">Hosted Redmine</a>',
			maxZoom : 19
		}
	).addTo(map);
	 
	var id=0;
	 $.ajax({
			type: 'GET',
			url: '/webservices/listeBatimentsXML',
			dataType: 'xml',
			success: function(xml) {
				$(xml).find('response batiment').each(
					function() {
						id++;
						var marker = L.marker([$(this).find('latitude').text(), $(this).find('longitude').text()]).addTo(map);
						var titlePOI = $(this).find('nom').text();
						marker.bindPopup(
							$("<b>" + titlePOI + "</b>")
							.append("<br/><br/>")
							.append("<button id=\"detailsButton\" class=\"btn btn-small btn-primary\" type=\"button\">En savoir +</button>")
							.click(function() {
								$('#details').modal('show');
								$("#myModalLabel").text(titlePOI);
						})[0]);
					}
				);
			}
		});
		
	/* Géolocalisation */
	//map.locate({setView: true, maxZoom: 16});
	/* Dimensions de la map selon la présence de la menu-bar */
	$(document).ready(function() {
		$.ajaxSetup({
			cache : false
		});
		if ($(window).width() > 767) {
			$('#map').css('height', ($(window).height() - 40));
		}
		if ($(window).width() < 767) {
			//Suppression copyright sur la version mobile
			$('.leaflet-bottom.leaflet-right').remove();
		}
	});

	$(window).resize(function() {
		if ($(window).width() > 767) {
			$('#map').css('height', ($(window).height() - 40));
		}
		if ($(window).width() < 767) {
			//Suppression copyright sur la version mobile
			$('.leaflet-bottom.leaflet-right').remove();
		}
	}).resize();
</script>